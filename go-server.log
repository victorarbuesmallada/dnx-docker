2016-05-27 14:41:06,034  INFO [main] GoSslSocketConnector:78 - Included ciphers: null
2016-05-27 14:41:06,036  INFO [main] GoSslSocketConnector:79 - Excluded ciphers: null
2016-05-27 14:41:06,036  INFO [main] GoSslSocketConnector:80 - Included protocols: null
2016-05-27 14:41:06,036  INFO [main] GoSslSocketConnector:81 - Excluded protocols: null
2016-05-27 14:41:06,037  INFO [main] GoSslSocketConnector:82 - Renegotiation Allowed: true
2016-05-27 14:41:06,177  INFO [main] Jetty9Server:161 - Configuring Jetty using /etc/go/jetty.xml
2016-05-27 14:41:06,327  INFO [main] GoServer:98 - Including addons: 
2016-05-27 14:41:24,381  INFO [main] H2Database:128 - [db] Using connection configuration jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener' [User: sa]
2016-05-27 14:41:24,383  INFO [main] H2Database:118 - Creating data source with url=jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'
2016-05-27 14:41:24,386  INFO [main] DbDeployMigration:48 - Upgrading database at org.apache.commons.dbcp.BasicDataSource@65d4dad5. This might take a while depending on the size of the database.
2016-05-27 14:41:24,616  INFO [main] H2EventListener:30 - Initializing database: jdbc:h2:db/h2db/cruise
2016-05-27 14:41:27,023  INFO [main] H2EventListener:82 - Creating index SYS:SYS_ID 0%
2016-05-27 14:41:27,024  INFO [main] H2EventListener:82 - Creating index SYS:SYS_ID 0%
2016-05-27 14:41:27,375  INFO [main] H2EventListener:34 - Database is opened
2016-05-27 14:41:27,388  INFO [main] H2EventListener:30 - Initializing database: jdbc:h2:db/h2db/cruise
2016-05-27 14:41:27,439  INFO [main] H2EventListener:30 - Initializing database: jdbc:h2:db/h2db/cruise
2016-05-27 14:41:27,719 ERROR [main] H2EventListener:38 - Exception thrown from database on sql statement: 

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------


org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:329)
	at org.h2.message.DbException.get(DbException.java:169)
	at org.h2.message.DbException.get(DbException.java:146)
	at org.h2.command.ddl.DropView.update(DropView.java:54)
	at org.h2.command.CommandContainer.update(CommandContainer.java:75)
	at org.h2.command.Command.executeUpdate(Command.java:230)
	at org.h2.command.CommandList.update(CommandList.java:41)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.Command.executeUpdate(Command.java:230)
	at org.h2.jdbc.JdbcStatement.executeInternal(JdbcStatement.java:177)
	at org.h2.jdbc.JdbcStatement.execute(JdbcStatement.java:152)
	at org.apache.commons.dbcp.DelegatingStatement.execute(DelegatingStatement.java:264)
	at org.apache.commons.dbcp.DelegatingStatement.execute(DelegatingStatement.java:264)
	at org.springframework.jdbc.core.JdbcTemplate$1ExecuteStatementCallback.doInStatement(JdbcTemplate.java:421)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:396)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:428)
	at com.thoughtworks.go.server.database.DbDeployMigration.upgradeWithDbDeploy(DbDeployMigration.java:54)
	at com.thoughtworks.go.server.database.DbDeployMigration.migrate(DbDeployMigration.java:44)
	at com.thoughtworks.go.server.database.H2Database.upgrade(H2Database.java:164)
	at com.thoughtworks.go.server.database.DatabaseStrategy.upgrade(DatabaseStrategy.java:59)
	at com.thoughtworks.go.server.util.DatabaseUpgraderDataSourceFactory.upgradeDb(DatabaseUpgraderDataSourceFactory.java:50)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor$LifecycleElement.invoke(InitDestroyAnnotationBeanPostProcessor.java:346)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor$LifecycleMetadata.invokeInitMethods(InitDestroyAnnotationBeanPostProcessor.java:299)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor.postProcessBeforeInitialization(InitDestroyAnnotationBeanPostProcessor.java:132)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyBeanPostProcessorsBeforeInitialization(AbstractAutowireCapableBeanFactory.java:394)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1448)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:519)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:353)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1015)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:911)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:323)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:107)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1360)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1118)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:517)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:872)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:872)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:271)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:121)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getSingletonFactoryBeanForTypeCheck(AbstractAutowireCapableBeanFactory.java:767)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:698)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:323)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:107)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:605)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:925)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:472)
	at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:383)
	at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:283)
	at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:111)
	at org.eclipse.jetty.server.handler.ContextHandler.callContextInitialized(ContextHandler.java:800)
	at org.eclipse.jetty.servlet.ServletContextHandler.callContextInitialized(ServletContextHandler.java:444)
	at org.eclipse.jetty.server.handler.ContextHandler.startContext(ContextHandler.java:791)
	at org.eclipse.jetty.servlet.ServletContextHandler.startContext(ServletContextHandler.java:294)
	at org.eclipse.jetty.webapp.WebAppContext.startWebapp(WebAppContext.java:1349)
	at org.eclipse.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1342)
	at org.eclipse.jetty.server.handler.ContextHandler.doStart(ContextHandler.java:741)
	at org.eclipse.jetty.webapp.WebAppContext.doStart(WebAppContext.java:505)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.server.Server.start(Server.java:387)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.server.Server.doStart(Server.java:354)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at com.thoughtworks.go.server.Jetty9Server.start(Jetty9Server.java:89)
	at com.thoughtworks.go.server.GoServer.startServer(GoServer.java:71)
	at com.thoughtworks.go.server.GoServer.go(GoServer.java:63)
	at com.thoughtworks.go.server.util.GoLauncher.main(GoLauncher.java:31)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.simontuffs.onejar.Boot.run(Boot.java:306)
	at com.simontuffs.onejar.Boot.main(Boot.java:159)
2016-05-27 14:41:27,764 ERROR [main] H2EventListener:38 - Exception thrown from database on sql statement: 

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------


org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:329)
	at org.h2.message.DbException.get(DbException.java:169)
	at org.h2.message.DbException.get(DbException.java:146)
	at org.h2.command.ddl.DropView.update(DropView.java:54)
	at org.h2.command.CommandContainer.update(CommandContainer.java:75)
	at org.h2.command.Command.executeUpdate(Command.java:230)
	at org.h2.command.CommandList.update(CommandList.java:41)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.Command.executeUpdate(Command.java:230)
	at org.h2.jdbc.JdbcStatement.executeInternal(JdbcStatement.java:177)
	at org.h2.jdbc.JdbcStatement.execute(JdbcStatement.java:152)
	at org.apache.commons.dbcp.DelegatingStatement.execute(DelegatingStatement.java:264)
	at org.apache.commons.dbcp.DelegatingStatement.execute(DelegatingStatement.java:264)
	at org.springframework.jdbc.core.JdbcTemplate$1ExecuteStatementCallback.doInStatement(JdbcTemplate.java:421)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:396)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:428)
	at com.thoughtworks.go.server.database.DbDeployMigration.upgradeWithDbDeploy(DbDeployMigration.java:54)
	at com.thoughtworks.go.server.database.DbDeployMigration.migrate(DbDeployMigration.java:44)
	at com.thoughtworks.go.server.database.H2Database.upgrade(H2Database.java:164)
	at com.thoughtworks.go.server.database.DatabaseStrategy.upgrade(DatabaseStrategy.java:59)
	at com.thoughtworks.go.server.util.DatabaseUpgraderDataSourceFactory.upgradeDb(DatabaseUpgraderDataSourceFactory.java:50)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor$LifecycleElement.invoke(InitDestroyAnnotationBeanPostProcessor.java:346)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor$LifecycleMetadata.invokeInitMethods(InitDestroyAnnotationBeanPostProcessor.java:299)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor.postProcessBeforeInitialization(InitDestroyAnnotationBeanPostProcessor.java:132)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyBeanPostProcessorsBeforeInitialization(AbstractAutowireCapableBeanFactory.java:394)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1448)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:519)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:353)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1015)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:911)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:323)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:107)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1360)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1118)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:517)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:872)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:872)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:271)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:121)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getSingletonFactoryBeanForTypeCheck(AbstractAutowireCapableBeanFactory.java:767)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:698)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:323)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:107)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:605)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:925)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:472)
	at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:383)
	at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:283)
	at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:111)
	at org.eclipse.jetty.server.handler.ContextHandler.callContextInitialized(ContextHandler.java:800)
	at org.eclipse.jetty.servlet.ServletContextHandler.callContextInitialized(ServletContextHandler.java:444)
	at org.eclipse.jetty.server.handler.ContextHandler.startContext(ContextHandler.java:791)
	at org.eclipse.jetty.servlet.ServletContextHandler.startContext(ServletContextHandler.java:294)
	at org.eclipse.jetty.webapp.WebAppContext.startWebapp(WebAppContext.java:1349)
	at org.eclipse.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1342)
	at org.eclipse.jetty.server.handler.ContextHandler.doStart(ContextHandler.java:741)
	at org.eclipse.jetty.webapp.WebAppContext.doStart(WebAppContext.java:505)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.server.Server.start(Server.java:387)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.server.Server.doStart(Server.java:354)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at com.thoughtworks.go.server.Jetty9Server.start(Jetty9Server.java:89)
	at com.thoughtworks.go.server.GoServer.startServer(GoServer.java:71)
	at com.thoughtworks.go.server.GoServer.go(GoServer.java:63)
	at com.thoughtworks.go.server.util.GoLauncher.main(GoLauncher.java:31)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.simontuffs.onejar.Boot.run(Boot.java:306)
	at com.simontuffs.onejar.Boot.main(Boot.java:159)
2016-05-27 14:41:28,201 ERROR [main] DbDeployMigration:60 - Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
org.springframework.jdbc.UncategorizedSQLException: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:83)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:80)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:80)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:407)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:428)
	at com.thoughtworks.go.server.database.DbDeployMigration.upgradeWithDbDeploy(DbDeployMigration.java:54)
	at com.thoughtworks.go.server.database.DbDeployMigration.migrate(DbDeployMigration.java:44)
	at com.thoughtworks.go.server.database.H2Database.upgrade(H2Database.java:164)
	at com.thoughtworks.go.server.database.DatabaseStrategy.upgrade(DatabaseStrategy.java:59)
	at com.thoughtworks.go.server.util.DatabaseUpgraderDataSourceFactory.upgradeDb(DatabaseUpgraderDataSourceFactory.java:50)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor$LifecycleElement.invoke(InitDestroyAnnotationBeanPostProcessor.java:346)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor$LifecycleMetadata.invokeInitMethods(InitDestroyAnnotationBeanPostProcessor.java:299)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor.postProcessBeforeInitialization(InitDestroyAnnotationBeanPostProcessor.java:132)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyBeanPostProcessorsBeforeInitialization(AbstractAutowireCapableBeanFactory.java:394)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1448)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:519)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:353)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1015)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:911)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:323)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:107)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1360)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1118)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:517)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:872)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:872)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:271)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:121)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getSingletonFactoryBeanForTypeCheck(AbstractAutowireCapableBeanFactory.java:767)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:698)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:323)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:107)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:605)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:925)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:472)
	at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:383)
	at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:283)
	at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:111)
	at org.eclipse.jetty.server.handler.ContextHandler.callContextInitialized(ContextHandler.java:800)
	at org.eclipse.jetty.servlet.ServletContextHandler.callContextInitialized(ServletContextHandler.java:444)
	at org.eclipse.jetty.server.handler.ContextHandler.startContext(ContextHandler.java:791)
	at org.eclipse.jetty.servlet.ServletContextHandler.startContext(ServletContextHandler.java:294)
	at org.eclipse.jetty.webapp.WebAppContext.startWebapp(WebAppContext.java:1349)
	at org.eclipse.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1342)
	at org.eclipse.jetty.server.handler.ContextHandler.doStart(ContextHandler.java:741)
	at org.eclipse.jetty.webapp.WebAppContext.doStart(WebAppContext.java:505)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.server.Server.start(Server.java:387)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.server.Server.doStart(Server.java:354)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at com.thoughtworks.go.server.Jetty9Server.start(Jetty9Server.java:89)
	at com.thoughtworks.go.server.GoServer.startServer(GoServer.java:71)
	at com.thoughtworks.go.server.GoServer.go(GoServer.java:63)
	at com.thoughtworks.go.server.util.GoLauncher.main(GoLauncher.java:31)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.simontuffs.onejar.Boot.run(Boot.java:306)
	at com.simontuffs.onejar.Boot.main(Boot.java:159)
Caused by: org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:329)
	at org.h2.message.DbException.get(DbException.java:169)
	at org.h2.message.DbException.get(DbException.java:146)
	at org.h2.command.ddl.DropView.update(DropView.java:54)
	at org.h2.command.CommandContainer.update(CommandContainer.java:75)
	at org.h2.command.Command.executeUpdate(Command.java:230)
	at org.h2.command.CommandList.update(CommandList.java:41)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.Command.executeUpdate(Command.java:230)
	at org.h2.jdbc.JdbcStatement.executeInternal(JdbcStatement.java:177)
	at org.h2.jdbc.JdbcStatement.execute(JdbcStatement.java:152)
	at org.apache.commons.dbcp.DelegatingStatement.execute(DelegatingStatement.java:264)
	at org.apache.commons.dbcp.DelegatingStatement.execute(DelegatingStatement.java:264)
	at org.springframework.jdbc.core.JdbcTemplate$1ExecuteStatementCallback.doInStatement(JdbcTemplate.java:421)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:396)
	... 137 more
2016-05-27 14:41:28,241 ERROR [main] ContextLoader:307 - Context initialization failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'stagesQuery' defined in ServletContext resource [/WEB-INF/applicationContext-shine-server.xml]: Cannot resolve reference to bean 'lazyStageGraphLoader' while setting constructor argument; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'lazyStageGraphLoader' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/studios/shine/cruise/stage/details/LazyStageGraphLoader.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.studios.shine.cruise.stage.details.StageResourceImporter]: : Error creating bean with name 'goAuthenticationProviderFactory' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Cannot create inner bean 'com.thoughtworks.go.server.service.UserService#44dc688f' of type [com.thoughtworks.go.server.service.UserService] while setting constructor argument; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'com.thoughtworks.go.server.service.UserService#44dc688f' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.go.server.dao.UserDao]: : Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'goAuthenticationProviderFactory' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Cannot create inner bean 'com.thoughtworks.go.server.service.UserService#44dc688f' of type [com.thoughtworks.go.server.service.UserService] while setting constructor argument; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'com.thoughtworks.go.server.service.UserService#44dc688f' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.go.server.dao.UserDao]: : Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
Related cause: org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'goAuthenticationProviderFactory': Requested bean is currently in creation: Is there an unresolvable circular reference?
Related cause: org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'sqlMapClient': Requested bean is currently in creation: Is there an unresolvable circular reference?
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:329)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:107)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:605)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:925)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:472)
	at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:383)
	at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:283)
	at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:111)
	at org.eclipse.jetty.server.handler.ContextHandler.callContextInitialized(ContextHandler.java:800)
	at org.eclipse.jetty.servlet.ServletContextHandler.callContextInitialized(ServletContextHandler.java:444)
	at org.eclipse.jetty.server.handler.ContextHandler.startContext(ContextHandler.java:791)
	at org.eclipse.jetty.servlet.ServletContextHandler.startContext(ServletContextHandler.java:294)
	at org.eclipse.jetty.webapp.WebAppContext.startWebapp(WebAppContext.java:1349)
	at org.eclipse.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1342)
	at org.eclipse.jetty.server.handler.ContextHandler.doStart(ContextHandler.java:741)
	at org.eclipse.jetty.webapp.WebAppContext.doStart(WebAppContext.java:505)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.server.Server.start(Server.java:387)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.server.Server.doStart(Server.java:354)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at com.thoughtworks.go.server.Jetty9Server.start(Jetty9Server.java:89)
	at com.thoughtworks.go.server.GoServer.startServer(GoServer.java:71)
	at com.thoughtworks.go.server.GoServer.go(GoServer.java:63)
	at com.thoughtworks.go.server.util.GoLauncher.main(GoLauncher.java:31)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.simontuffs.onejar.Boot.run(Boot.java:306)
	at com.simontuffs.onejar.Boot.main(Boot.java:159)
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'lazyStageGraphLoader' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/studios/shine/cruise/stage/details/LazyStageGraphLoader.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.studios.shine.cruise.stage.details.StageResourceImporter]: : Error creating bean with name 'goAuthenticationProviderFactory' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Cannot create inner bean 'com.thoughtworks.go.server.service.UserService#44dc688f' of type [com.thoughtworks.go.server.service.UserService] while setting constructor argument; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'com.thoughtworks.go.server.service.UserService#44dc688f' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.go.server.dao.UserDao]: : Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'goAuthenticationProviderFactory' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Cannot create inner bean 'com.thoughtworks.go.server.service.UserService#44dc688f' of type [com.thoughtworks.go.server.service.UserService] while setting constructor argument; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'com.thoughtworks.go.server.service.UserService#44dc688f' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.go.server.dao.UserDao]: : Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:730)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:323)
	... 46 more
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'goAuthenticationProviderFactory' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Cannot create inner bean 'com.thoughtworks.go.server.service.UserService#44dc688f' of type [com.thoughtworks.go.server.service.UserService] while setting constructor argument; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'com.thoughtworks.go.server.service.UserService#44dc688f' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.go.server.dao.UserDao]: : Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:282)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:121)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getSingletonFactoryBeanForTypeCheck(AbstractAutowireCapableBeanFactory.java:767)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:698)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	... 56 more
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'com.thoughtworks.go.server.service.UserService#44dc688f' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.go.server.dao.UserDao]: : Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:730)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:271)
	... 72 more
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:730)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:872)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	... 78 more
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:329)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:107)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1360)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1118)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:517)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:872)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	... 92 more
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor.postProcessBeforeInitialization(InitDestroyAnnotationBeanPostProcessor.java:135)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyBeanPostProcessorsBeforeInitialization(AbstractAutowireCapableBeanFactory.java:394)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1448)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:519)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:353)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1015)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:911)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:323)
	... 106 more
Caused by: java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at com.thoughtworks.go.util.ExceptionUtils.bomb(ExceptionUtils.java:40)
	at com.thoughtworks.go.server.database.DbDeployMigration.upgradeWithDbDeploy(DbDeployMigration.java:61)
	at com.thoughtworks.go.server.database.DbDeployMigration.migrate(DbDeployMigration.java:44)
	at com.thoughtworks.go.server.database.H2Database.upgrade(H2Database.java:164)
	at com.thoughtworks.go.server.database.DatabaseStrategy.upgrade(DatabaseStrategy.java:59)
	at com.thoughtworks.go.server.util.DatabaseUpgraderDataSourceFactory.upgradeDb(DatabaseUpgraderDataSourceFactory.java:50)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor$LifecycleElement.invoke(InitDestroyAnnotationBeanPostProcessor.java:346)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor$LifecycleMetadata.invokeInitMethods(InitDestroyAnnotationBeanPostProcessor.java:299)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor.postProcessBeforeInitialization(InitDestroyAnnotationBeanPostProcessor.java:132)
	... 124 more
Caused by: org.springframework.jdbc.UncategorizedSQLException: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:83)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:80)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:80)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:407)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:428)
	at com.thoughtworks.go.server.database.DbDeployMigration.upgradeWithDbDeploy(DbDeployMigration.java:54)
	... 135 more
Caused by: org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:329)
	at org.h2.message.DbException.get(DbException.java:169)
	at org.h2.message.DbException.get(DbException.java:146)
	at org.h2.command.ddl.DropView.update(DropView.java:54)
	at org.h2.command.CommandContainer.update(CommandContainer.java:75)
	at org.h2.command.Command.executeUpdate(Command.java:230)
	at org.h2.command.CommandList.update(CommandList.java:41)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.Command.executeUpdate(Command.java:230)
	at org.h2.jdbc.JdbcStatement.executeInternal(JdbcStatement.java:177)
	at org.h2.jdbc.JdbcStatement.execute(JdbcStatement.java:152)
	at org.apache.commons.dbcp.DelegatingStatement.execute(DelegatingStatement.java:264)
	at org.apache.commons.dbcp.DelegatingStatement.execute(DelegatingStatement.java:264)
	at org.springframework.jdbc.core.JdbcTemplate$1ExecuteStatementCallback.doInStatement(JdbcTemplate.java:421)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:396)
	... 137 more
Related cause:
org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'goAuthenticationProviderFactory': Requested bean is currently in creation: Is there an unresolvable circular reference?
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.beforeSingletonCreation(DefaultSingletonBeanRegistry.java:300)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:219)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getTypeForFactoryBean(AbstractBeanFactory.java:1356)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:710)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:271)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:121)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getSingletonFactoryBeanForTypeCheck(AbstractAutowireCapableBeanFactory.java:767)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:698)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:323)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:107)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:605)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:925)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:472)
	at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:383)
	at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:283)
	at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:111)
	at org.eclipse.jetty.server.handler.ContextHandler.callContextInitialized(ContextHandler.java:800)
	at org.eclipse.jetty.servlet.ServletContextHandler.callContextInitialized(ServletContextHandler.java:444)
	at org.eclipse.jetty.server.handler.ContextHandler.startContext(ContextHandler.java:791)
	at org.eclipse.jetty.servlet.ServletContextHandler.startContext(ServletContextHandler.java:294)
	at org.eclipse.jetty.webapp.WebAppContext.startWebapp(WebAppContext.java:1349)
	at org.eclipse.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1342)
	at org.eclipse.jetty.server.handler.ContextHandler.doStart(ContextHandler.java:741)
	at org.eclipse.jetty.webapp.WebAppContext.doStart(WebAppContext.java:505)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.server.Server.start(Server.java:387)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.server.Server.doStart(Server.java:354)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at com.thoughtworks.go.server.Jetty9Server.start(Jetty9Server.java:89)
	at com.thoughtworks.go.server.GoServer.startServer(GoServer.java:71)
	at com.thoughtworks.go.server.GoServer.go(GoServer.java:63)
	at com.thoughtworks.go.server.util.GoLauncher.main(GoLauncher.java:31)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.simontuffs.onejar.Boot.run(Boot.java:306)
	at com.simontuffs.onejar.Boot.main(Boot.java:159)
Related cause:
org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'sqlMapClient': Requested bean is currently in creation: Is there an unresolvable circular reference?
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.beforeSingletonCreation(DefaultSingletonBeanRegistry.java:300)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:219)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getTypeForFactoryBean(AbstractBeanFactory.java:1356)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:710)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getSingletonFactoryBeanForTypeCheck(AbstractAutowireCapableBeanFactory.java:767)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:698)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:271)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:121)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getSingletonFactoryBeanForTypeCheck(AbstractAutowireCapableBeanFactory.java:767)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:698)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:323)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:107)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:605)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:925)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:472)
	at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:383)
	at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:283)
	at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:111)
	at org.eclipse.jetty.server.handler.ContextHandler.callContextInitialized(ContextHandler.java:800)
	at org.eclipse.jetty.servlet.ServletContextHandler.callContextInitialized(ServletContextHandler.java:444)
	at org.eclipse.jetty.server.handler.ContextHandler.startContext(ContextHandler.java:791)
	at org.eclipse.jetty.servlet.ServletContextHandler.startContext(ServletContextHandler.java:294)
	at org.eclipse.jetty.webapp.WebAppContext.startWebapp(WebAppContext.java:1349)
	at org.eclipse.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1342)
	at org.eclipse.jetty.server.handler.ContextHandler.doStart(ContextHandler.java:741)
	at org.eclipse.jetty.webapp.WebAppContext.doStart(WebAppContext.java:505)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.server.Server.start(Server.java:387)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.server.Server.doStart(Server.java:354)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at com.thoughtworks.go.server.Jetty9Server.start(Jetty9Server.java:89)
	at com.thoughtworks.go.server.GoServer.startServer(GoServer.java:71)
	at com.thoughtworks.go.server.GoServer.go(GoServer.java:63)
	at com.thoughtworks.go.server.util.GoLauncher.main(GoLauncher.java:31)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.simontuffs.onejar.Boot.run(Boot.java:306)
	at com.simontuffs.onejar.Boot.main(Boot.java:159)
2016-05-27 14:41:28,345  WARN [main] WebAppContext:514 - Failed startup of context o.e.j.w.WebAppContext@7d127169{/go,file:/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/,STARTING}{cruise.war}
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'stagesQuery' defined in ServletContext resource [/WEB-INF/applicationContext-shine-server.xml]: Cannot resolve reference to bean 'lazyStageGraphLoader' while setting constructor argument; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'lazyStageGraphLoader' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/studios/shine/cruise/stage/details/LazyStageGraphLoader.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.studios.shine.cruise.stage.details.StageResourceImporter]: : Error creating bean with name 'goAuthenticationProviderFactory' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Cannot create inner bean 'com.thoughtworks.go.server.service.UserService#44dc688f' of type [com.thoughtworks.go.server.service.UserService] while setting constructor argument; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'com.thoughtworks.go.server.service.UserService#44dc688f' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.go.server.dao.UserDao]: : Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'goAuthenticationProviderFactory' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Cannot create inner bean 'com.thoughtworks.go.server.service.UserService#44dc688f' of type [com.thoughtworks.go.server.service.UserService] while setting constructor argument; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'com.thoughtworks.go.server.service.UserService#44dc688f' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.go.server.dao.UserDao]: : Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
Related cause: org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'goAuthenticationProviderFactory': Requested bean is currently in creation: Is there an unresolvable circular reference?
Related cause: org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'sqlMapClient': Requested bean is currently in creation: Is there an unresolvable circular reference?
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:329)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:107)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:605)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:925)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:472)
	at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:383)
	at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:283)
	at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:111)
	at org.eclipse.jetty.server.handler.ContextHandler.callContextInitialized(ContextHandler.java:800)
	at org.eclipse.jetty.servlet.ServletContextHandler.callContextInitialized(ServletContextHandler.java:444)
	at org.eclipse.jetty.server.handler.ContextHandler.startContext(ContextHandler.java:791)
	at org.eclipse.jetty.servlet.ServletContextHandler.startContext(ServletContextHandler.java:294)
	at org.eclipse.jetty.webapp.WebAppContext.startWebapp(WebAppContext.java:1349)
	at org.eclipse.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1342)
	at org.eclipse.jetty.server.handler.ContextHandler.doStart(ContextHandler.java:741)
	at org.eclipse.jetty.webapp.WebAppContext.doStart(WebAppContext.java:505)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.server.Server.start(Server.java:387)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.server.Server.doStart(Server.java:354)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at com.thoughtworks.go.server.Jetty9Server.start(Jetty9Server.java:89)
	at com.thoughtworks.go.server.GoServer.startServer(GoServer.java:71)
	at com.thoughtworks.go.server.GoServer.go(GoServer.java:63)
	at com.thoughtworks.go.server.util.GoLauncher.main(GoLauncher.java:31)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.simontuffs.onejar.Boot.run(Boot.java:306)
	at com.simontuffs.onejar.Boot.main(Boot.java:159)
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'lazyStageGraphLoader' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/studios/shine/cruise/stage/details/LazyStageGraphLoader.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.studios.shine.cruise.stage.details.StageResourceImporter]: : Error creating bean with name 'goAuthenticationProviderFactory' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Cannot create inner bean 'com.thoughtworks.go.server.service.UserService#44dc688f' of type [com.thoughtworks.go.server.service.UserService] while setting constructor argument; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'com.thoughtworks.go.server.service.UserService#44dc688f' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.go.server.dao.UserDao]: : Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'goAuthenticationProviderFactory' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Cannot create inner bean 'com.thoughtworks.go.server.service.UserService#44dc688f' of type [com.thoughtworks.go.server.service.UserService] while setting constructor argument; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'com.thoughtworks.go.server.service.UserService#44dc688f' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.go.server.dao.UserDao]: : Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:730)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:323)
	... 46 more
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'goAuthenticationProviderFactory' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Cannot create inner bean 'com.thoughtworks.go.server.service.UserService#44dc688f' of type [com.thoughtworks.go.server.service.UserService] while setting constructor argument; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'com.thoughtworks.go.server.service.UserService#44dc688f' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.go.server.dao.UserDao]: : Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:282)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:121)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getSingletonFactoryBeanForTypeCheck(AbstractAutowireCapableBeanFactory.java:767)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:698)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	... 56 more
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'com.thoughtworks.go.server.service.UserService#44dc688f' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.go.server.dao.UserDao]: : Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:730)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:271)
	... 72 more
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:730)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:872)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	... 78 more
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:329)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:107)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1360)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1118)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:517)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:872)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	... 92 more
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor.postProcessBeforeInitialization(InitDestroyAnnotationBeanPostProcessor.java:135)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyBeanPostProcessorsBeforeInitialization(AbstractAutowireCapableBeanFactory.java:394)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1448)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:519)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:353)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1015)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:911)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:323)
	... 106 more
Caused by: java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at com.thoughtworks.go.util.ExceptionUtils.bomb(ExceptionUtils.java:40)
	at com.thoughtworks.go.server.database.DbDeployMigration.upgradeWithDbDeploy(DbDeployMigration.java:61)
	at com.thoughtworks.go.server.database.DbDeployMigration.migrate(DbDeployMigration.java:44)
	at com.thoughtworks.go.server.database.H2Database.upgrade(H2Database.java:164)
	at com.thoughtworks.go.server.database.DatabaseStrategy.upgrade(DatabaseStrategy.java:59)
	at com.thoughtworks.go.server.util.DatabaseUpgraderDataSourceFactory.upgradeDb(DatabaseUpgraderDataSourceFactory.java:50)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor$LifecycleElement.invoke(InitDestroyAnnotationBeanPostProcessor.java:346)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor$LifecycleMetadata.invokeInitMethods(InitDestroyAnnotationBeanPostProcessor.java:299)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor.postProcessBeforeInitialization(InitDestroyAnnotationBeanPostProcessor.java:132)
	... 124 more
Caused by: org.springframework.jdbc.UncategorizedSQLException: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:83)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:80)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:80)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:407)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:428)
	at com.thoughtworks.go.server.database.DbDeployMigration.upgradeWithDbDeploy(DbDeployMigration.java:54)
	... 135 more
Caused by: org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:329)
	at org.h2.message.DbException.get(DbException.java:169)
	at org.h2.message.DbException.get(DbException.java:146)
	at org.h2.command.ddl.DropView.update(DropView.java:54)
	at org.h2.command.CommandContainer.update(CommandContainer.java:75)
	at org.h2.command.Command.executeUpdate(Command.java:230)
	at org.h2.command.CommandList.update(CommandList.java:41)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.Command.executeUpdate(Command.java:230)
	at org.h2.jdbc.JdbcStatement.executeInternal(JdbcStatement.java:177)
	at org.h2.jdbc.JdbcStatement.execute(JdbcStatement.java:152)
	at org.apache.commons.dbcp.DelegatingStatement.execute(DelegatingStatement.java:264)
	at org.apache.commons.dbcp.DelegatingStatement.execute(DelegatingStatement.java:264)
	at org.springframework.jdbc.core.JdbcTemplate$1ExecuteStatementCallback.doInStatement(JdbcTemplate.java:421)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:396)
	... 137 more
Related cause:
org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'goAuthenticationProviderFactory': Requested bean is currently in creation: Is there an unresolvable circular reference?
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.beforeSingletonCreation(DefaultSingletonBeanRegistry.java:300)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:219)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getTypeForFactoryBean(AbstractBeanFactory.java:1356)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:710)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:271)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:121)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getSingletonFactoryBeanForTypeCheck(AbstractAutowireCapableBeanFactory.java:767)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:698)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:323)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:107)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:605)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:925)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:472)
	at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:383)
	at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:283)
	at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:111)
	at org.eclipse.jetty.server.handler.ContextHandler.callContextInitialized(ContextHandler.java:800)
	at org.eclipse.jetty.servlet.ServletContextHandler.callContextInitialized(ServletContextHandler.java:444)
	at org.eclipse.jetty.server.handler.ContextHandler.startContext(ContextHandler.java:791)
	at org.eclipse.jetty.servlet.ServletContextHandler.startContext(ServletContextHandler.java:294)
	at org.eclipse.jetty.webapp.WebAppContext.startWebapp(WebAppContext.java:1349)
	at org.eclipse.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1342)
	at org.eclipse.jetty.server.handler.ContextHandler.doStart(ContextHandler.java:741)
	at org.eclipse.jetty.webapp.WebAppContext.doStart(WebAppContext.java:505)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.server.Server.start(Server.java:387)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.server.Server.doStart(Server.java:354)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at com.thoughtworks.go.server.Jetty9Server.start(Jetty9Server.java:89)
	at com.thoughtworks.go.server.GoServer.startServer(GoServer.java:71)
	at com.thoughtworks.go.server.GoServer.go(GoServer.java:63)
	at com.thoughtworks.go.server.util.GoLauncher.main(GoLauncher.java:31)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.simontuffs.onejar.Boot.run(Boot.java:306)
	at com.simontuffs.onejar.Boot.main(Boot.java:159)
Related cause:
org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'sqlMapClient': Requested bean is currently in creation: Is there an unresolvable circular reference?
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.beforeSingletonCreation(DefaultSingletonBeanRegistry.java:300)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:219)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getTypeForFactoryBean(AbstractBeanFactory.java:1356)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:710)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getSingletonFactoryBeanForTypeCheck(AbstractAutowireCapableBeanFactory.java:767)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:698)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:271)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:121)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getSingletonFactoryBeanForTypeCheck(AbstractAutowireCapableBeanFactory.java:767)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:698)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:323)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:107)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:605)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:925)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:472)
	at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:383)
	at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:283)
	at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:111)
	at org.eclipse.jetty.server.handler.ContextHandler.callContextInitialized(ContextHandler.java:800)
	at org.eclipse.jetty.servlet.ServletContextHandler.callContextInitialized(ServletContextHandler.java:444)
	at org.eclipse.jetty.server.handler.ContextHandler.startContext(ContextHandler.java:791)
	at org.eclipse.jetty.servlet.ServletContextHandler.startContext(ServletContextHandler.java:294)
	at org.eclipse.jetty.webapp.WebAppContext.startWebapp(WebAppContext.java:1349)
	at org.eclipse.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1342)
	at org.eclipse.jetty.server.handler.ContextHandler.doStart(ContextHandler.java:741)
	at org.eclipse.jetty.webapp.WebAppContext.doStart(WebAppContext.java:505)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.server.Server.start(Server.java:387)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.server.Server.doStart(Server.java:354)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at com.thoughtworks.go.server.Jetty9Server.start(Jetty9Server.java:89)
	at com.thoughtworks.go.server.GoServer.startServer(GoServer.java:71)
	at com.thoughtworks.go.server.GoServer.go(GoServer.java:63)
	at com.thoughtworks.go.server.util.GoLauncher.main(GoLauncher.java:31)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.simontuffs.onejar.Boot.run(Boot.java:306)
	at com.simontuffs.onejar.Boot.main(Boot.java:159)
2016-05-27 14:41:28,676 ERROR [main] GoServer:76 - ERROR: Failed to start Go server.
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'stagesQuery' defined in ServletContext resource [/WEB-INF/applicationContext-shine-server.xml]: Cannot resolve reference to bean 'lazyStageGraphLoader' while setting constructor argument; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'lazyStageGraphLoader' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/studios/shine/cruise/stage/details/LazyStageGraphLoader.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.studios.shine.cruise.stage.details.StageResourceImporter]: : Error creating bean with name 'goAuthenticationProviderFactory' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Cannot create inner bean 'com.thoughtworks.go.server.service.UserService#44dc688f' of type [com.thoughtworks.go.server.service.UserService] while setting constructor argument; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'com.thoughtworks.go.server.service.UserService#44dc688f' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.go.server.dao.UserDao]: : Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'goAuthenticationProviderFactory' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Cannot create inner bean 'com.thoughtworks.go.server.service.UserService#44dc688f' of type [com.thoughtworks.go.server.service.UserService] while setting constructor argument; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'com.thoughtworks.go.server.service.UserService#44dc688f' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.go.server.dao.UserDao]: : Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
Related cause: org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'goAuthenticationProviderFactory': Requested bean is currently in creation: Is there an unresolvable circular reference?
Related cause: org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'sqlMapClient': Requested bean is currently in creation: Is there an unresolvable circular reference?
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:329)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:107)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:605)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:925)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:472)
	at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:383)
	at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:283)
	at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:111)
	at org.eclipse.jetty.server.handler.ContextHandler.callContextInitialized(ContextHandler.java:800)
	at org.eclipse.jetty.servlet.ServletContextHandler.callContextInitialized(ServletContextHandler.java:444)
	at org.eclipse.jetty.server.handler.ContextHandler.startContext(ContextHandler.java:791)
	at org.eclipse.jetty.servlet.ServletContextHandler.startContext(ServletContextHandler.java:294)
	at org.eclipse.jetty.webapp.WebAppContext.startWebapp(WebAppContext.java:1349)
	at org.eclipse.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1342)
	at org.eclipse.jetty.server.handler.ContextHandler.doStart(ContextHandler.java:741)
	at org.eclipse.jetty.webapp.WebAppContext.doStart(WebAppContext.java:505)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.server.Server.start(Server.java:387)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.server.Server.doStart(Server.java:354)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at com.thoughtworks.go.server.Jetty9Server.start(Jetty9Server.java:89)
	at com.thoughtworks.go.server.GoServer.startServer(GoServer.java:71)
	at com.thoughtworks.go.server.GoServer.go(GoServer.java:63)
	at com.thoughtworks.go.server.util.GoLauncher.main(GoLauncher.java:31)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.simontuffs.onejar.Boot.run(Boot.java:306)
	at com.simontuffs.onejar.Boot.main(Boot.java:159)
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'lazyStageGraphLoader' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/studios/shine/cruise/stage/details/LazyStageGraphLoader.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.studios.shine.cruise.stage.details.StageResourceImporter]: : Error creating bean with name 'goAuthenticationProviderFactory' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Cannot create inner bean 'com.thoughtworks.go.server.service.UserService#44dc688f' of type [com.thoughtworks.go.server.service.UserService] while setting constructor argument; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'com.thoughtworks.go.server.service.UserService#44dc688f' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.go.server.dao.UserDao]: : Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'goAuthenticationProviderFactory' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Cannot create inner bean 'com.thoughtworks.go.server.service.UserService#44dc688f' of type [com.thoughtworks.go.server.service.UserService] while setting constructor argument; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'com.thoughtworks.go.server.service.UserService#44dc688f' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.go.server.dao.UserDao]: : Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:730)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:323)
	... 46 more
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'goAuthenticationProviderFactory' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Cannot create inner bean 'com.thoughtworks.go.server.service.UserService#44dc688f' of type [com.thoughtworks.go.server.service.UserService] while setting constructor argument; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'com.thoughtworks.go.server.service.UserService#44dc688f' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.go.server.dao.UserDao]: : Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:282)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:121)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getSingletonFactoryBeanForTypeCheck(AbstractAutowireCapableBeanFactory.java:767)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:698)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	... 56 more
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'com.thoughtworks.go.server.service.UserService#44dc688f' defined in ServletContext resource [/WEB-INF/applicationContext-acegi-security.xml]: Unsatisfied dependency expressed through constructor argument with index 0 of type [com.thoughtworks.go.server.dao.UserDao]: : Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:730)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:271)
	... 72 more
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userSqlMapDao' defined in file [/var/lib/go-server/work/jetty-0.0.0.0-8153-cruise.war-_go-any-/webapp/WEB-INF/classes/com/thoughtworks/go/server/dao/UserSqlMapDao.class]: Unsatisfied dependency expressed through constructor argument with index 0 of type [org.hibernate.SessionFactory]: : Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:730)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:872)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	... 78 more
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in ServletContext resource [/WEB-INF/applicationContext-dataLocalAccess.xml]: Cannot resolve reference to bean 'goDataSource' while setting bean property 'dataSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:329)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:107)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1360)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1118)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:517)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:872)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	... 92 more
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'databaseUpgraderDataSourceFactory': Invocation of init method failed; nested exception is java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor.postProcessBeforeInitialization(InitDestroyAnnotationBeanPostProcessor.java:135)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyBeanPostProcessorsBeforeInitialization(AbstractAutowireCapableBeanFactory.java:394)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1448)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:519)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:353)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1015)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:911)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:323)
	... 106 more
Caused by: java.lang.RuntimeException: Unable to create database upgrade script for database jdbc:h2:db/h2db/cruise;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MVCC=FALSE;CACHE_SIZE=131072;TRACE_LEVEL_FILE=1;TRACE_MAX_FILE_SIZE=16;DATABASE_EVENT_LISTENER='com.thoughtworks.go.server.util.H2EventListener'. The problem was: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]. The cause was: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at com.thoughtworks.go.util.ExceptionUtils.bomb(ExceptionUtils.java:40)
	at com.thoughtworks.go.server.database.DbDeployMigration.upgradeWithDbDeploy(DbDeployMigration.java:61)
	at com.thoughtworks.go.server.database.DbDeployMigration.migrate(DbDeployMigration.java:44)
	at com.thoughtworks.go.server.database.H2Database.upgrade(H2Database.java:164)
	at com.thoughtworks.go.server.database.DatabaseStrategy.upgrade(DatabaseStrategy.java:59)
	at com.thoughtworks.go.server.util.DatabaseUpgraderDataSourceFactory.upgradeDb(DatabaseUpgraderDataSourceFactory.java:50)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor$LifecycleElement.invoke(InitDestroyAnnotationBeanPostProcessor.java:346)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor$LifecycleMetadata.invokeInitMethods(InitDestroyAnnotationBeanPostProcessor.java:299)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor.postProcessBeforeInitialization(InitDestroyAnnotationBeanPostProcessor.java:132)
	... 124 more
Caused by: org.springframework.jdbc.UncategorizedSQLException: StatementCallback; uncategorized SQLException for SQL [

--------------- Fragment begins: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403001, 'DDL', CURRENT_TIMESTAMP, USER(), '1403001_fix_null_artifacttype_on_artifactplans_table.sql');
COMMIT;


-- Change script: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql
UPDATE ARTIFACTPLANS SET ARTIFACTTYPE='file' WHERE ARTIFACTTYPE IS NULL;
COMMIT;

-- No undo as adding default value to mandatory field



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403001: 1403001_fix_null_artifacttype_on_artifactplans_table.sql ---------------


--------------- Fragment begins: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1403002, 'DDL', CURRENT_TIMESTAMP, USER(), '1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql');
COMMIT;


-- Change script: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

alter table builds add column runMultipleInstance boolean default false;

DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

]; SQL state [90037]; error code [90037]; View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]; nested exception is org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:83)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:80)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:80)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:407)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:428)
	at com.thoughtworks.go.server.database.DbDeployMigration.upgradeWithDbDeploy(DbDeployMigration.java:54)
	... 135 more
Caused by: org.h2.jdbc.JdbcSQLException: View "_BUILDS" not found; SQL statement:


DROP VIEW _builds;

CREATE VIEW _builds AS
SELECT b.*,
  p.id pipelineId, p.name pipelineName, p.label pipelineLabel, p.counter pipelineCounter,
  s.name stageName, s.counter stageCounter, s.fetchMaterials, s.cleanWorkingDir, s.rerunOfCounter
FROM builds b
  INNER JOIN stages s ON s.id = b.stageId
  INNER JOIN pipelines p ON p.id = s.pipelineId;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1403002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1403002: 1403002_add_runMultipleInstance_column_on_builds_table_recreate_view.sql ---------------


--------------- Fragment begins: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501001, 'DDL', CURRENT_TIMESTAMP, USER(), '1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql');
COMMIT;


-- Change script: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelineselections ALTER COLUMN unselectedpipelines RENAME TO selections;

ALTER TABLE pipelineselections ADD COLUMN isblacklist BOOLEAN DEFAULT true;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501001: 1501001_rename_pipeline_selections_unselected_pipelines_column_to_selections.sql ---------------


--------------- Fragment begins: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501002, 'DDL', CURRENT_TIMESTAMP, USER(), '1501002_add_comment_column_to_pipelines.sql');
COMMIT;


-- Change script: #1501002: 1501002_add_comment_column_to_pipelines.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE pipelines ADD COLUMN comment TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501002: 1501002_add_comment_column_to_pipelines.sql ---------------


--------------- Fragment begins: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1501003, 'DDL', CURRENT_TIMESTAMP, USER(), '1501003_add_additional_data_field_to_materials_table.sql');
COMMIT;


-- Change script: #1501003: 1501003_add_additional_data_field_to_materials_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE materials ADD COLUMN additionalData TEXT;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1501003 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1501003: 1501003_add_additional_data_field_to_materials_table.sql ---------------


--------------- Fragment begins: #1502001: 1502001_create_plugins_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1502001, 'DDL', CURRENT_TIMESTAMP, USER(), '1502001_create_plugins_table.sql');
COMMIT;


-- Change script: #1502001: 1502001_create_plugins_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE plugins (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    pluginId        VARCHAR(255) Not NULL,
    configuration   TEXT,
    UNIQUE (pluginId)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1502001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1502001: 1502001_create_plugins_table.sql ---------------


--------------- Fragment begins: #1503001: 1503001_remove_licensing_from_users.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503001, 'DDL', CURRENT_TIMESTAMP, USER(), '1503001_remove_licensing_from_users.sql');
COMMIT;


-- Change script: #1503001: 1503001_remove_licensing_from_users.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2014 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

ALTER TABLE users DROP COLUMN disableLicenseExpiryWarning;



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503001 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503001: 1503001_remove_licensing_from_users.sql ---------------


--------------- Fragment begins: #1503002: 1503002_create_version_infos_table.sql ---------------
INSERT INTO changelog (change_number, delta_set, start_dt, applied_by, description) VALUES (1503002, 'DDL', CURRENT_TIMESTAMP, USER(), '1503002_create_version_infos_table.sql');
COMMIT;


-- Change script: #1503002: 1503002_create_version_infos_table.sql
--*************************GO-LICENSE-START*********************************
-- Copyright 2015 ThoughtWorks, Inc.
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
--    http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--*************************GO-LICENSE-END***********************************

CREATE TABLE versioninfos (
    id                      BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
    componentName           VARCHAR(255) Not NULL,
    installedVersion        VARCHAR(100) Not NULL,
    latestVersion           VARCHAR(50),
    latestVersionUpdatedAt  TIMESTAMP,
    UNIQUE (componentName)
);



UPDATE changelog SET complete_dt = CURRENT_TIMESTAMP WHERE change_number = 1503002 AND delta_set = 'DDL';
COMMIT;
--------------- Fragment ends: #1503002: 1503002_create_version_infos_table.sql ---------------

 [90037-168]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:329)
	at org.h2.message.DbException.get(DbException.java:169)
	at org.h2.message.DbException.get(DbException.java:146)
	at org.h2.command.ddl.DropView.update(DropView.java:54)
	at org.h2.command.CommandContainer.update(CommandContainer.java:75)
	at org.h2.command.Command.executeUpdate(Command.java:230)
	at org.h2.command.CommandList.update(CommandList.java:41)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.CommandList.executeRemaining(CommandList.java:36)
	at org.h2.command.CommandList.update(CommandList.java:42)
	at org.h2.command.Command.executeUpdate(Command.java:230)
	at org.h2.jdbc.JdbcStatement.executeInternal(JdbcStatement.java:177)
	at org.h2.jdbc.JdbcStatement.execute(JdbcStatement.java:152)
	at org.apache.commons.dbcp.DelegatingStatement.execute(DelegatingStatement.java:264)
	at org.apache.commons.dbcp.DelegatingStatement.execute(DelegatingStatement.java:264)
	at org.springframework.jdbc.core.JdbcTemplate$1ExecuteStatementCallback.doInStatement(JdbcTemplate.java:421)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:396)
	... 137 more
Related cause:
org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'goAuthenticationProviderFactory': Requested bean is currently in creation: Is there an unresolvable circular reference?
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.beforeSingletonCreation(DefaultSingletonBeanRegistry.java:300)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:219)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getTypeForFactoryBean(AbstractBeanFactory.java:1356)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:710)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:271)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:121)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getSingletonFactoryBeanForTypeCheck(AbstractAutowireCapableBeanFactory.java:767)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:698)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:323)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:107)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:605)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:925)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:472)
	at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:383)
	at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:283)
	at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:111)
	at org.eclipse.jetty.server.handler.ContextHandler.callContextInitialized(ContextHandler.java:800)
	at org.eclipse.jetty.servlet.ServletContextHandler.callContextInitialized(ServletContextHandler.java:444)
	at org.eclipse.jetty.server.handler.ContextHandler.startContext(ContextHandler.java:791)
	at org.eclipse.jetty.servlet.ServletContextHandler.startContext(ServletContextHandler.java:294)
	at org.eclipse.jetty.webapp.WebAppContext.startWebapp(WebAppContext.java:1349)
	at org.eclipse.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1342)
	at org.eclipse.jetty.server.handler.ContextHandler.doStart(ContextHandler.java:741)
	at org.eclipse.jetty.webapp.WebAppContext.doStart(WebAppContext.java:505)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.server.Server.start(Server.java:387)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.server.Server.doStart(Server.java:354)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at com.thoughtworks.go.server.Jetty9Server.start(Jetty9Server.java:89)
	at com.thoughtworks.go.server.GoServer.startServer(GoServer.java:71)
	at com.thoughtworks.go.server.GoServer.go(GoServer.java:63)
	at com.thoughtworks.go.server.util.GoLauncher.main(GoLauncher.java:31)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.simontuffs.onejar.Boot.run(Boot.java:306)
	at com.simontuffs.onejar.Boot.main(Boot.java:159)
Related cause:
org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'sqlMapClient': Requested bean is currently in creation: Is there an unresolvable circular reference?
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.beforeSingletonCreation(DefaultSingletonBeanRegistry.java:300)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:219)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getTypeForFactoryBean(AbstractBeanFactory.java:1356)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:710)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getSingletonFactoryBeanForTypeCheck(AbstractAutowireCapableBeanFactory.java:767)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:698)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:271)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:121)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getSingletonFactoryBeanForTypeCheck(AbstractAutowireCapableBeanFactory.java:767)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:698)
	at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeMatch(AbstractBeanFactory.java:519)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doGetBeanNamesForType(DefaultListableBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanNamesForType(DefaultListableBeanFactory.java:316)
	at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIncludingAncestors(BeanFactoryUtils.java:187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:857)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:814)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:731)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:723)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:196)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:323)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:107)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveConstructorArguments(ConstructorResolver.java:616)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:148)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1035)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:939)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:605)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:925)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:472)
	at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:383)
	at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:283)
	at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:111)
	at org.eclipse.jetty.server.handler.ContextHandler.callContextInitialized(ContextHandler.java:800)
	at org.eclipse.jetty.servlet.ServletContextHandler.callContextInitialized(ServletContextHandler.java:444)
	at org.eclipse.jetty.server.handler.ContextHandler.startContext(ContextHandler.java:791)
	at org.eclipse.jetty.servlet.ServletContextHandler.startContext(ServletContextHandler.java:294)
	at org.eclipse.jetty.webapp.WebAppContext.startWebapp(WebAppContext.java:1349)
	at org.eclipse.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1342)
	at org.eclipse.jetty.server.handler.ContextHandler.doStart(ContextHandler.java:741)
	at org.eclipse.jetty.webapp.WebAppContext.doStart(WebAppContext.java:505)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:132)
	at org.eclipse.jetty.server.Server.start(Server.java:387)
	at org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:114)
	at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:61)
	at org.eclipse.jetty.server.Server.doStart(Server.java:354)
	at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68)
	at com.thoughtworks.go.server.Jetty9Server.start(Jetty9Server.java:89)
	at com.thoughtworks.go.server.GoServer.startServer(GoServer.java:71)
	at com.thoughtworks.go.server.GoServer.go(GoServer.java:63)
	at com.thoughtworks.go.server.util.GoLauncher.main(GoLauncher.java:31)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.simontuffs.onejar.Boot.run(Boot.java:306)
	at com.simontuffs.onejar.Boot.main(Boot.java:159)
